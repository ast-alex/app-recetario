doctype html
html
  head
    title Prescripción para #{paciente.nombre} #{paciente.apellido}
  body
    h1 Prescripción para #{paciente.nombre} #{paciente.apellido}

    form(action='/prescripciones' method='POST')
      input(type='hidden' name='id_paciente' value=paciente.id_paciente)

      // Datos de la prescripción
      div
        label(for='id_profesional_salud') Profesional de Salud:
        input(type='text' name='id_profesional_salud' required)

      div
        label(for='diagnostico') Diagnóstico:
        textarea(name='diagnostico' required)

      div
        label(for='fecha_prescripcion') Fecha de Prescripción:
        input(type='date' name='fecha_prescripcion' required)

      div
        label(for='vigencia') Vigencia:
        input(type='date' name='vigencia' required)

      // Medicamentos
      h2 Medicamentos
      div#medicamentos

      button(type='button' onclick='addMedicamento()') Añadir Medicamento

      // Prestaciones
      h2 Prestaciones
      div#prestaciones

      button(type='button' onclick='addPrestacion()') Añadir Prestación

      // Botón de guardar
      button(type='submit') Guardar Prescripción
      button.btn.btn-secondary(type='button' style='margin-top: 10px;' onclick="window.location.href='/pacientes'") Volver a la lista de pacientes


    // Pasar datos del servidor al cliente
    script.
      var presentaciones = !{JSON.stringify(presentaciones)};
      var prestaciones = !{JSON.stringify(prestaciones)};

    script.
      var presentaciones = !{JSON.stringify(presentaciones)};

      function addMedicamento() {
        var container = document.getElementById('medicamentos');
        var div = document.createElement('div');
        div.className = 'medicamento';
        div.innerHTML = `
            <select name="medicamentos[id_presentacion][]" required>
              <option value="">Seleccione una presentación</option>
              ${presentaciones.map(presentacion => `
                <option value="${presentacion.id_presentacion}">
              ${presentacion.nombre_comercial} (${presentacion.nombre_generico}, ${presentacion.concentracion}, ${presentacion.forma_farmaceutica}, ${presentacion.cantidad_unidades})
                </option>
              `).join('')}
            </select>
            <input type="text" name="medicamentos[duracion][]" placeholder="Duración" required>
            <input type="text" name="medicamentos[intervalo_administracion][]" placeholder="Intervalo de Administración" required>
            <button type="button" onclick="removeMedicamento(this)">Eliminar</button>
            `;
            container.appendChild(div);
        }


      function addPrestacion() {
        var container = document.getElementById('prestaciones');
        var div = document.createElement('div');
        div.className = 'prestacion';
        div.innerHTML = `
          <select name="prestaciones[id_prestacion][]" required>
            <option value="">Seleccione una prestación</option>
            ${prestaciones.map(prestacion => `
              <option value="${prestacion.id_prestacion}">${prestacion.nombre}</option>
            `).join('')}
          </select>
          <input type="text" name="prestaciones[observacion][]" placeholder="Observación" required>
          <input type="text" name="prestaciones[resultado][]" placeholder="Resultado" required>
          <button type="button" onclick="removePrestacion(this)">Eliminar</button>
        `;
        container.appendChild(div);
      }

      function removeMedicamento(button) {
        var div = button.parentNode;
        div.parentNode.removeChild(div);
      }

      function removePrestacion(button) {
        var div = button.parentNode;
        div.parentNode.removeChild(div);
      }

