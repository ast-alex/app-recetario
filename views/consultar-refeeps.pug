doctype html
html
  head
    title Consulta REFEPS
    link(rel="stylesheet", href="/styles/consultar-refeeps.css")
    link(rel="stylesheet", href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css")
    link(rel="stylesheet", href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css")
    script(src="https://code.jquery.com/jquery-3.5.1.min.js")
    script(src="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.all.min.js")

  body
    nav.navbar.navbar-expand-lg.navbar-dark.bg-primary.mb-4
      a.navbar-brand(href="/home") Clínica
      button.navbar-toggler(type="button", data-toggle="collapse", data-target="#navbarSupportedContent")
        span.navbar-toggler-icon
      .collapse.navbar-collapse#navbarSupportedContent
        ul.navbar-nav.mr-auto
          li.nav-item
            a.nav-link(href="/home") Home
          li.nav-item
            a.nav-link(href="/pacientes") Pacientes
          li.nav-item
            a.nav-link(href="/profesionales") Profesionales
          li.nav-item.active
            a.nav-link(href="/profesionales/consultar-refeeps") Consulta REFEPS
          li.nav-item
            a.nav-link(href="usuarioAdmin/miperfil") Mi Perfil
        ul.navbar-nav
          li.nav-item
            a.nav-link(href="/auth/logout") Logout

    .container.mt-5
      h2.text-center.text-primary.mb-4 Consulta de Profesional por ID REFEPS

      form#formConsulta(class="mb-4")
        .form-group
          label(for="id_refeeps") Ingresá un ID REFEPS:
          .input-group
            input.form-control(type="text", id="id_refeeps", required, placeholder="Ej: 112233")
            .input-group-append
              button.btn.btn-primary(type="submit")
                i.fas.fa-search.mr-1
                | Consultar

      #resultadoProfesional

      .text-center.mt-4
        a.btn.btn-outline-primary.mr-2(href="/home")
          i.fas.fa-home.mr-1
          | Volver al Inicio
        a.btn.btn-outline-secondary(href="/profesionales")
          i.fas.fa-users.mr-1
          | Lista Profesionales

    script.
      document.getElementById("formConsulta").addEventListener("submit", async function(e) {
        e.preventDefault();

        const id = document.getElementById("id_refeeps").value.trim();
        const resultadoDiv = document.getElementById("resultadoProfesional");

        if (!id) {
          Swal.fire("Advertencia", "Por favor ingresá un ID REFEPS.", "warning");
          return;
        }

        resultadoDiv.innerHTML = "";

        try {
          const res = await fetch(`/profesionales/validar-refeeps/${id}`);
          const data = await res.json();

          if (res.ok && data.valido) {
            const prof = data.profesional;
            resultadoDiv.innerHTML = `
              <div class="card resultado-card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title text-success"><i class="fas fa-user-check mr-2"></i>Profesional encontrado</h5>
                  <p><strong>Nombre:</strong> ${prof.nombre} ${prof.apellido}</p>
                  <p><strong>Matrícula:</strong> ${prof.matricula}</p>
                  <p><strong>Profesión:</strong> ${prof.profesion}</p>
                  <p><strong>Especialidad:</strong> ${prof.especialidad}</p>
                </div>
              </div>
            `;
          } else {
            Swal.fire("No encontrado", data.message || "No se encontró ningún profesional con ese ID.", "error");
          }
        } catch (err) {
          console.error(err);
          Swal.fire("Error", "Hubo un problema al consultar el ID REFEPS.", "error");
        }
      });
